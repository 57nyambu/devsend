{% extends "base.html" %}

{% block title %}Templates - DevSend{% endblock %}

{% block content %}
    <div class="container mt-4">
        <div class="page-header">
            <div>
                <h1>Email Templates</h1>
                <p class="text-muted mb-0">Create and manage reusable email templates</p>
            </div>
            <div>
                <button class="btn btn-outline-primary me-2" onclick="loadSampleTemplates()">
                    <i class="fas fa-clipboard-list me-1"></i> Load Sample Templates
                </button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">
                    <i class="fas fa-plus me-1"></i> Create Template
                </button>
            </div>
        </div>

        <div class="table-container">
            <div class="mb-3">
                <div class="search-bar">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search templates...">
                </div>
            </div>

        <table class="table" id="templatesTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Subject</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for template in templates %}
                <tr>
                    <td>
                        <strong>{{ template.name }}</strong>
                        {% if template.name.startswith('Sample:') %}
                        <span class="badge bg-info ms-2">Sample</span>
                        {% endif %}
                    </td>
                    <td>{{ template.subject }}</td>
                    <td class="text-muted">{{ template.created_at.strftime('%b %d, %Y') }}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary" onclick="previewTemplate({{ template.id }})">
                                <i class="fas fa-eye me-1"></i> Preview
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="duplicateTemplate({{ template.id }})">
                                <i class="fas fa-copy me-1"></i> Duplicate
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTemplate({{ template.id }})">
                                <i class="fas fa-trash me-1"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>

    <!-- Add Modal -->
    <div class="modal fade" id="addModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Email Template</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Template Name *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Subject Line *</label>
                            <input type="text" class="form-control" name="subject" required>
                            <small class="text-muted">Use {{name}}, {{email}} for placeholders</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Template Type</label>
                            <select class="form-control" id="templateType" onchange="loadTemplateType()">
                                <option value="blank">Blank Template (Customizable)</option>
                                <option value="marketing">Marketing Email (Business Solutions)</option>
                                <option value="newsletter">Newsletter (Monthly Updates)</option>
                                <option value="promotional">Promotional (Sales & Offers)</option>
                                <option value="transactional">Transactional (Order Confirmation)</option>
                                <option value="welcome">Welcome Email (Onboarding)</option>
                            </select>
                            <small class="text-muted">Select a template type to generate professional, ready-to-use HTML</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Logo URL</label>
                            <input type="text" class="form-control" id="logoUrl" placeholder="https://example.com/logo.png">
                            <small class="text-muted">Your company logo URL (will appear at the top of the email)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Company/Brand Name</label>
                            <input type="text" class="form-control" id="companyName" placeholder="Your Company">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">HTML Body *</label>
                            <textarea class="form-control" name="html_body" id="html_body" rows="15" required></textarea>
                            <small class="text-muted">Use {{name}}, {{email}}, {{company}}, {{product}}, {{link}} as placeholders</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Text Body</label>
                            <textarea class="form-control" name="text_body" rows="5"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Footer Information</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="text" class="form-control mb-2" id="companyAddress" placeholder="Company Address">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control mb-2" id="companyPhone" placeholder="Phone Number">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control mb-2" id="companyWebsite" placeholder="Website URL">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control mb-2" id="unsubscribeLink" placeholder="Unsubscribe Link">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Social Media Links</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <input type="text" class="form-control mb-2" id="facebookUrl" placeholder="Facebook URL">
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control mb-2" id="twitterUrl" placeholder="Twitter URL">
                                </div>
                                <div class="col-md-4">
                                    <input type="text" class="form-control mb-2" id="linkedinUrl" placeholder="LinkedIn URL">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Placeholders (JSON array)</label>
                            <input type="text" class="form-control" name="placeholders" value='["name", "email", "company", "product", "link"]'>
                        </div>
                        <div class="mb-3">
                            <button type="button" class="btn btn-outline-primary" onclick="generateTemplate()">
                                Generate Professional Template
                            </button>
                            <small class="text-muted ms-2">This will create a professional HTML template with your settings</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
    <script>
        setupSearch('templatesTable');
        
        document.getElementById('addForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            setLoading(btn, true);
            
            try {
                await apiRequest('/api/templates', 'POST', new FormData(e.target));
                showToast('Template created successfully!', 'success');
                setTimeout(() => location.reload(), 1000);
            } catch (error) {
                setLoading(btn, false);
            }
        });

        async function previewTemplate(id) {
            const data = await apiRequest(`/api/templates/${id}`, 'GET');
            const previewWindow = window.open('', 'Template Preview', 'width=800,height=600');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>${data.subject}</title>
                    <style>body { font-family: Arial, sans-serif; padding: 20px; }</style>
                </head>
                <body>
                    <h3>Subject: ${data.subject}</h3>
                    <hr>
                    ${data.html_body}
                </body>
                </html>
            `);
        }

        async function deleteTemplate(id) {
            if (confirmAction('Are you sure you want to delete this template?')) {
                await apiRequest(`/api/templates/${id}`, 'DELETE');
                showToast('Template deleted successfully!', 'success');
                setTimeout(() => location.reload(), 1000);
            }
        }

        function loadTemplateType() {
            const type = document.getElementById('templateType').value;
            const templates = getTemplatesByType(type);
            // Don't auto-fill, just make it available for generation
        }

        function generateTemplate() {
            const type = document.getElementById('templateType').value;
            const logoUrl = document.getElementById('logoUrl').value || 'https://via.placeholder.com/150x50?text=Logo';
            const companyName = document.getElementById('companyName').value || '{{company}}';
            const companyAddress = document.getElementById('companyAddress').value || '';
            const companyPhone = document.getElementById('companyPhone').value || '';
            const companyWebsite = document.getElementById('companyWebsite').value || '';
            const unsubscribeLink = document.getElementById('unsubscribeLink').value || '{{unsubscribe_link}}';
            const facebookUrl = document.getElementById('facebookUrl').value;
            const twitterUrl = document.getElementById('twitterUrl').value;
            const linkedinUrl = document.getElementById('linkedinUrl').value;

            let htmlBody = '';
            
            // Professional email wrapper with modern styling
            const emailHeader = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${companyName}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f8fafc; -webkit-font-smoothing: antialiased; }
        .email-container { max-width: 600px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); }
        .header { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 40px 30px; text-align: center; border-bottom: 4px solid #3b82f6; }
        .header img { max-width: 180px; height: auto; }
        .content { padding: 45px 35px; color: #1e293b; line-height: 1.7; }
        .content h1 { font-family: 'Poppins', sans-serif; color: #0f172a; font-size: 32px; font-weight: 700; margin: 0 0 24px 0; letter-spacing: -0.5px; }
        .content h2 { font-family: 'Poppins', sans-serif; color: #1e293b; font-size: 22px; font-weight: 600; margin: 32px 0 16px 0; }
        .content p { font-size: 16px; margin-bottom: 16px; color: #475569; }
        .content strong { color: #1e293b; font-weight: 600; }
        .cta-button { display: inline-block; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: #ffffff !important; padding: 16px 42px; text-decoration: none; border-radius: 8px; font-weight: 600; margin: 24px 0; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); font-size: 16px; transition: all 0.3s ease; }
        .cta-button:hover { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4); }
        .highlight-box { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-left: 4px solid #3b82f6; padding: 24px; margin: 24px 0; border-radius: 8px; }
        .icon-feature { display: flex; align-items: start; margin: 16px 0; }
        .icon-feature svg { width: 24px; height: 24px; margin-right: 12px; flex-shrink: 0; margin-top: 2px; }
        .feature-list { margin: 20px 0; }
        .feature-item { display: flex; align-items: center; margin: 12px 0; padding: 12px; background: #f8fafc; border-radius: 6px; }
        .feature-item svg { width: 20px; height: 20px; margin-right: 12px; flex-shrink: 0; }
        .footer { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #cbd5e1; padding: 40px 30px; text-align: center; }
        .footer p { margin: 8px 0; font-size: 14px; }
        .footer a { color: #60a5fa; text-decoration: none; }
        .footer a:hover { color: #93c5fd; text-decoration: underline; }
        .divider { height: 1px; background: linear-gradient(90deg, transparent 0%, #e2e8f0 50%, transparent 100%); margin: 32px 0; }
        .social-links { margin: 24px 0; }
        .social-links a { display: inline-block; margin: 0 8px; width: 40px; height: 40px; background: #1e293b; border-radius: 50%; padding: 8px; transition: all 0.3s ease; }
        .social-links a:hover { background: #3b82f6; transform: translateY(-2px); }
        .social-links svg { width: 24px; height: 24px; fill: #cbd5e1; }
        @media only screen and (max-width: 600px) {
            .content { padding: 30px 20px; }
            .content h1 { font-size: 26px; }
            .cta-button { padding: 14px 32px; width: 100%; text-align: center; }
            .header { padding: 30px 20px; }
        }
    </style>
</head>
<body>
    <div class="email-container">
        <div class="header">
            <img src="${logoUrl}" alt="${companyName} Logo">
        </div>
        <div class="content">
`;

            const emailFooter = `
        </div>
        <div class="footer">
            ${companyName ? `<p style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">${companyName}</p>` : ''}
            ${companyAddress ? `<p style="color: #94a3b8;">${companyAddress}</p>` : ''}
            ${companyPhone ? `<p style="color: #94a3b8;">Phone: ${companyPhone}</p>` : ''}
            ${companyWebsite ? `<p style="color: #94a3b8;">Website: <a href="${companyWebsite}" style="color: #60a5fa;">${companyWebsite}</a></p>` : ''}
            ${(facebookUrl || twitterUrl || linkedinUrl) ? `
            <div class="social-links">
                ${facebookUrl ? `<a href="${facebookUrl}" title="Facebook"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg></a>` : ''}
                ${twitterUrl ? `<a href="${twitterUrl}" title="Twitter"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a>` : ''}
                ${linkedinUrl ? `<a href="${linkedinUrl}" title="LinkedIn"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>` : ''}
            </div>` : ''}
            <div class="divider" style="background: linear-gradient(90deg, transparent 0%, #334155 50%, transparent 100%);"></div>
            <p style="font-size: 12px; color: #64748b; margin-top: 20px;">
                This email was sent to <span style="color: #94a3b8;">{{email}}</span>. If you no longer wish to receive these emails, 
                <a href="${unsubscribeLink}" style="color: #60a5fa;">unsubscribe here</a>.
            </p>
            <p style="font-size: 12px; color: #475569;">Â© ${new Date().getFullYear()} ${companyName}. All rights reserved.</p>
        </div>
    </div>
</body>
</html>
`;

            // Template-specific content
            switch(type) {
                case 'marketing':
                    htmlBody = emailHeader + `
            <h1>Hello {{name}}, Welcome to Excellence</h1>
            <p style="font-size: 18px; color: #475569;">We're excited to share something special with you today that will transform the way you work.</p>
            
            <div class="highlight-box">
                <h2 style="margin-top: 0; display: flex; align-items: center;">
                    <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 28px; margin-right: 12px;"></i>
                    Why Choose Us?
                </h2>
                <div class="feature-list">
                    <div class="feature-item">
                        <i class="fas fa-circle-check" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><strong>Industry-leading solutions</strong> powered by cutting-edge technology</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-users" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><strong>Trusted by 50,000+ customers</strong> worldwide</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-headset" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><strong>24/7 dedicated support</strong> from our expert team</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-star" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><strong>Award-winning platform</strong> with proven results</span>
                    </div>
                </div>
            </div>
            
            <p>We believe in delivering exceptional value to our customers, and we're confident you'll love what we have to offer. Join thousands of satisfied customers who have transformed their business with our solutions.</p>
            
            <p style="text-align: center;">
                <a href="{{link}}" class="cta-button">Learn More About Our Solutions</a>
            </p>
            
            <div class="divider"></div>
            
            <p style="font-size: 15px; color: #64748b;">Have questions? Our team is here to help! Simply reply to this email or contact us anytime.</p>
            
            <p style="margin-top: 32px;"><strong>Best regards,</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
                    break;

                case 'newsletter':
                    htmlBody = emailHeader + `
            <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 6px 16px; border-radius: 6px; display: inline-block; margin-bottom: 24px;">
                <span style="color: white; font-weight: 600; font-size: 14px;">Monthly Newsletter</span>
            </div>
            <h1>Your Monthly Update</h1>
            <p style="font-size: 18px; color: #475569;">Hi {{name}},</p>
            <p style="font-size: 17px;">Here's what's new this month at ${companyName}! We've packed this edition with insights, updates, and resources to help you succeed.</p>
            
            <div class="divider"></div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-rocket" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                Feature Highlights
            </h2>
            <div class="highlight-box">
                <p style="font-size: 17px; margin-bottom: 8px;"><strong style="color: #1e293b;">New Feature Launch:</strong></p>
                <p style="margin-bottom: 0;">We've just released <strong style="color: #3b82f6;">{{product}}</strong> - designed to streamline your workflow and boost productivity. This powerful addition includes advanced automation, real-time collaboration, and intuitive controls.</p>
            </div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-newspaper" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                Latest Articles & Resources
            </h2>
            <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0;">
                <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: start;">
                        <i class="fas fa-file-alt" style="color: #3b82f6; font-size: 20px; margin-right: 12px; margin-top: 2px;"></i>
                        <div>
                            <a href="{{link}}" style="color: #1e293b; font-weight: 600; text-decoration: none; font-size: 16px;">How to Maximize Your Productivity in 2025</a>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #64748b;">Expert strategies and proven techniques</p>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e2e8f0;">
                    <div style="display: flex; align-items: start;">
                        <i class="fas fa-file-alt" style="color: #3b82f6; font-size: 20px; margin-right: 12px; margin-top: 2px;"></i>
                        <div>
                            <a href="{{link}}" style="color: #1e293b; font-weight: 600; text-decoration: none; font-size: 16px;">Industry Trends You Need to Know</a>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #64748b;">Stay ahead of the competition</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; align-items: start;">
                        <i class="fas fa-file-alt" style="color: #3b82f6; font-size: 20px; margin-right: 12px; margin-top: 2px;"></i>
                        <div>
                            <a href="{{link}}" style="color: #1e293b; font-weight: 600; text-decoration: none; font-size: 16px;">Customer Success Stories</a>
                            <p style="margin: 4px 0 0 0; font-size: 14px; color: #64748b;">Real results from real businesses</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-lightbulb" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                Pro Tips & Best Practices
            </h2>
            <p><strong>Did you know?</strong> You can save up to 5 hours per week by leveraging our advanced automation features. Here are some quick wins:</p>
            <div class="feature-list">
                <div class="feature-item">
                    <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                    <span>Set up automated workflows for repetitive tasks</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                    <span>Use keyboard shortcuts to navigate faster</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                    <span>Integrate with your favorite tools for seamless workflow</span>
                </div>
            </div>
            <p style="margin-top: 16px;">Check out our <a href="{{link}}" style="color: #3b82f6; text-decoration: none; font-weight: 600;">knowledge base</a> for comprehensive guides and tutorials.</p>
            
            <p style="text-align: center; margin-top: 40px;">
                <a href="{{link}}" class="cta-button">View Full Newsletter</a>
            </p>
            
            <div class="divider"></div>
            
            <p style="margin-top: 32px;"><strong>Stay tuned for more updates!</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
                    break;

                case 'promotional':
                    htmlBody = emailHeader + `
            <div style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); padding: 6px 16px; border-radius: 6px; display: inline-block; margin-bottom: 24px;">
                <span style="color: white; font-weight: 600; font-size: 14px;">Limited Time Offer</span>
            </div>
            <h1>Exclusive Offer Just for You!</h1>
            <p style="font-size: 18px; color: #475569;">Hi {{name}},</p>
            <p style="font-size: 17px;">We're thrilled to offer you an exclusive promotion that you won't want to miss! As a valued customer, you get first access to this incredible deal.</p>
            
            <div style="text-align: center; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 3px solid #f59e0b; padding: 40px 30px; margin: 32px 0; border-radius: 12px; box-shadow: 0 8px 16px rgba(245, 158, 11, 0.2);">
                <div style="display: inline-block; background: #dc2626; color: white; padding: 8px 20px; border-radius: 20px; font-weight: 700; font-size: 14px; letter-spacing: 0.5px; margin-bottom: 16px;">
                    <i class="fas fa-star" style="font-size: 16px; vertical-align: middle; margin-right: 6px;"></i>
                    LIMITED TIME OFFER
                </div>
                <h2 style="font-size: 42px; margin: 16px 0; color: #92400e; font-family: 'Poppins', sans-serif; font-weight: 700; line-height: 1.2;">Save 50% on<br>{{product}}</h2>
                <div style="background: white; display: inline-block; padding: 16px 32px; border-radius: 8px; margin-top: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <p style="font-size: 14px; color: #64748b; margin: 0 0 4px 0; font-weight: 500;">Use Promo Code</p>
                    <p style="font-size: 32px; color: #dc2626; margin: 0; font-weight: 700; font-family: 'Courier New', monospace; letter-spacing: 2px;">SAVE50</p>
                </div>
            </div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-info-circle" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                Why Act Now?
            </h2>
            <div class="feature-list">
                <div class="feature-item" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-left: 3px solid #22c55e;">
                    <i class="fas fa-circle-check" style="color: #22c55e; font-size: 20px;"></i>
                    <span><strong>Exclusive discount</strong> for valued customers like you</span>
                </div>
                <div class="feature-item" style="background: linear-gradient(135deg, #fef3c7 0%, #fef08a 100%); border-left: 3px solid #eab308;">
                    <i class="fas fa-clock" style="color: #eab308; font-size: 20px;"></i>
                    <span><strong>Limited quantities available</strong> - First come, first served</span>
                </div>
                <div class="feature-item" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-left: 3px solid #dc2626;">
                    <i class="fas fa-hourglass-half" style="color: #dc2626; font-size: 20px;"></i>
                    <span><strong>Offer expires in 48 hours</strong> - Don't wait!</span>
                </div>
                <div class="feature-item" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 3px solid #3b82f6;">
                    <i class="fas fa-truck" style="color: #3b82f6; font-size: 20px;"></i>
                    <span><strong>Free shipping</strong> on all orders - No hidden fees</span>
                </div>
            </div>
            
            <p style="text-align: center; margin-top: 40px;">
                <a href="{{link}}" class="cta-button" style="font-size: 18px; padding: 18px 48px;">Claim Your 50% Discount Now</a>
            </p>
            
            <div style="text-align: center; background: #fef2f2; padding: 16px; border-radius: 8px; margin-top: 32px; border-left: 4px solid #dc2626;">
                <i class="fas fa-clock" style="color: #dc2626; font-size: 24px; vertical-align: middle; margin-right: 8px;"></i>
                <span style="color: #dc2626; font-size: 16px; font-weight: 600;">Hurry! This offer ends soon</span>
            </div>
            
            <div class="divider"></div>
            
            <p style="font-size: 17px;">Don't miss out on this incredible opportunity to save big!</p>
            <p style="margin-top: 32px;"><strong>Best regards,</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
                    break;

                case 'welcome':
                    htmlBody = emailHeader + `
            <div style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); padding: 6px 16px; border-radius: 6px; display: inline-block; margin-bottom: 24px;">
                <span style="color: white; font-weight: 600; font-size: 14px;">Welcome!</span>
            </div>
            <h1>Welcome to ${companyName}!</h1>
            <p style="font-size: 18px; color: #475569;">Hi {{name}},</p>
            <p style="font-size: 17px;">We're absolutely thrilled to have you join our community! Thank you for choosing ${companyName} - you've just taken the first step toward transforming your workflow and achieving more.</p>
            
            <div style="text-align: center; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 30px; border-radius: 12px; margin: 32px 0;">
                <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 80px; margin-bottom: 16px;"></i>
                <p style="font-size: 20px; color: #1e293b; margin: 0; font-weight: 600;">Your account is ready to go!</p>
            </div>
            
            <div class="highlight-box">
                <h2 style="margin-top: 0; display: flex; align-items: center;">
                    <i class="fas fa-rocket" style="color: #3b82f6; font-size: 28px; margin-right: 12px;"></i>
                    Get Started in 3 Easy Steps
                </h2>
                <div style="margin-top: 20px;">
                    <div style="display: flex; align-items: start; margin: 20px 0; padding: 16px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 16px; flex-shrink: 0;">1</div>
                        <div>
                            <p style="margin: 0; font-weight: 600; color: #1e293b; font-size: 16px;">Complete Your Profile</p>
                            <p style="margin: 4px 0 0 0; color: #64748b; font-size: 14px;">Personalize your experience and unlock all features</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; margin: 20px 0; padding: 16px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 16px; flex-shrink: 0;">2</div>
                        <div>
                            <p style="margin: 0; font-weight: 600; color: #1e293b; font-size: 16px;">Explore Our Features</p>
                            <p style="margin: 4px 0 0 0; color: #64748b; font-size: 14px;">Discover powerful tools designed to help you succeed</p>
                        </div>
                    </div>
                    <div style="display: flex; align-items: start; margin: 20px 0; padding: 16px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; margin-right: 16px; flex-shrink: 0;">3</div>
                        <div>
                            <p style="margin: 0; font-weight: 600; color: #1e293b; font-size: 16px;">Join Our Community</p>
                            <p style="margin: 4px 0 0 0; color: #64748b; font-size: 14px;">Connect with thousands of users and share insights</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-gift" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                What You Can Expect
            </h2>
            <div class="feature-list">
                <div class="feature-item">
                    <i class="fas fa-envelope" style="color: #3b82f6; font-size: 20px;"></i>
                    <span><strong>Regular updates</strong> with exclusive content and insights</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-headset" style="color: #3b82f6; font-size: 20px;"></i>
                    <span><strong>Priority customer support</strong> from our dedicated team</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-crown" style="color: #3b82f6; font-size: 20px;"></i>
                    <span><strong>Access to premium features</strong> and advanced tools</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-tags" style="color: #3b82f6; font-size: 20px;"></i>
                    <span><strong>Special offers and promotions</strong> throughout the year</span>
                </div>
            </div>
            
            <p style="text-align: center; margin-top: 40px;">
                <a href="{{link}}" class="cta-button">Complete Your Profile & Get Started</a>
            </p>
            
            <div class="divider"></div>
            
            <p style="font-size: 15px; color: #64748b;">If you have any questions or need assistance getting started, don't hesitate to reach out. Our support team is here to help you every step of the way!</p>
            
            <p style="margin-top: 32px;"><strong>Welcome aboard!</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
                    break;

                case 'transactional':
                    htmlBody = emailHeader + `
            <div style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); padding: 6px 16px; border-radius: 6px; display: inline-block; margin-bottom: 24px;">
                <span style="color: white; font-weight: 600; font-size: 14px;">Order Confirmed</span>
            </div>
            <h1>Order Confirmation</h1>
            <p style="font-size: 18px; color: #475569;">Hi {{name}},</p>
            <p style="font-size: 17px;">Thank you for your order! We've received your payment and are processing your order now. You'll receive a shipping confirmation email once your order is on its way.</p>
            
            <div style="text-align: center; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); padding: 30px; border-radius: 12px; margin: 32px 0;">
                <i class="fas fa-check-circle" style="color: #22c55e; font-size: 80px; margin-bottom: 16px;"></i>
                <p style="font-size: 20px; color: #1e293b; margin: 0; font-weight: 600;">Order Successfully Placed!</p>
            </div>
            
            <div class="highlight-box" style="background: white; border: 2px solid #e2e8f0;">
                <h2 style="margin-top: 0; display: flex; align-items: center; color: #1e293b;">
                    <i class="fas fa-clipboard-list" style="color: #3b82f6; font-size: 28px; margin-right: 12px;"></i>
                    Order Details
                </h2>
                <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b; font-size: 14px;">Order Number:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: 600; color: #1e293b; font-size: 15px;">#{{order_id}}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b; font-size: 14px;">Order Date:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: 600; color: #1e293b; font-size: 15px;">{{date}}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b; font-size: 14px;">Product:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: 600; color: #1e293b; font-size: 15px;">{{product}}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 0; color: #64748b; font-size: 14px;">Total Amount:</td>
                            <td style="padding: 12px 0; text-align: right; font-weight: 700; color: #22c55e; font-size: 18px;">{{total}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <h2 style="display: flex; align-items: center;">
                <i class="fas fa-tasks" style="color: #3b82f6; font-size: 26px; margin-right: 10px;"></i>
                What Happens Next?
            </h2>
            <div class="feature-list">
                <div class="feature-item">
                    <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; margin-right: 12px; flex-shrink: 0;">1</div>
                    <span>You'll receive a <strong>shipping confirmation email</strong> once your order ships</span>
                </div>
                <div class="feature-item">
                    <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; margin-right: 12px; flex-shrink: 0;">2</div>
                    <span><strong>Track your order</strong> anytime using your order number</span>
                </div>
                <div class="feature-item">
                    <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; margin-right: 12px; flex-shrink: 0;">3</div>
                    <span><strong>Contact us</strong> if you have any questions or concerns</span>
                </div>
            </div>
            
            <p style="text-align: center; margin-top: 40px;">
                <a href="{{link}}" class="cta-button">Track Your Order</a>
            </p>
            
            <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #3b82f6; margin-top: 32px;">
                <p style="margin: 0; color: #1e293b;"><strong>Need Help?</strong></p>
                <p style="margin: 8px 0 0 0; color: #475569; font-size: 15px;">Our customer support team is available 24/7. Reply to this email or visit our help center for assistance.</p>
            </div>
            
            <div class="divider"></div>
            
            <p style="margin-top: 32px;"><strong>Thank you for your business!</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
                    break;

                default:
                    htmlBody = emailHeader + `
            <h1>Hello {{name}}!</h1>
            <p style="font-size: 18px; color: #475569;">Welcome to our professional email template.</p>
            
            <div class="highlight-box">
                <h2 style="margin-top: 0;">Your Custom Content Goes Here</h2>
                <p>Replace this section with your own content. You can use the following placeholders:</p>
                <div class="feature-list">
                    <div class="feature-item">
                        <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><code style="background: #f1f5f9; padding: 2px 8px; border-radius: 4px; color: #dc2626;">{{name}}</code> - Recipient's name</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><code style="background: #f1f5f9; padding: 2px 8px; border-radius: 4px; color: #dc2626;">{{email}}</code> - Recipient's email</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><code style="background: #f1f5f9; padding: 2px 8px; border-radius: 4px; color: #dc2626;">{{company}}</code> - Company name</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check-circle" style="color: #3b82f6; font-size: 20px;"></i>
                        <span><code style="background: #f1f5f9; padding: 2px 8px; border-radius: 4px; color: #dc2626;">{{link}}</code> - Custom link</span>
                    </div>
                </div>
            </div>
            
            <p>This is a professionally designed email template with modern styling, responsive design, and clean typography. Customize it to match your brand and messaging needs.</p>
            
            <p style="text-align: center; margin-top: 40px;">
                <a href="{{link}}" class="cta-button">Take Action</a>
            </p>
            
            <div class="divider"></div>
            
            <p style="margin-top: 32px;"><strong>Best regards,</strong><br><span style="color: #3b82f6; font-weight: 600;">The ${companyName} Team</span></p>
` + emailFooter;
            }

            document.getElementById('html_body').value = htmlBody;
            showToast('Professional template generated! You can now customize it further.', 'success');
        }

        function getTemplatesByType(type) {
            // Template definitions for future use
            return {};
        }

        async function loadSampleTemplates() {
            if (!confirmAction('This will create 4 professional sample templates (Marketing, Promotional, Welcome, Newsletter). Continue?')) {
                return;
            }
            
            try {
                await apiRequest('/api/templates/create-samples', 'POST');
                showToast('Sample templates created successfully! Refreshing...', 'success');
                setTimeout(() => location.reload(), 1500);
            } catch (error) {
                // Error already handled by apiRequest
            }
        }

        async function duplicateTemplate(id) {
            try {
                const data = await apiRequest(`/api/templates/${id}`, 'GET');
                
                // Pre-fill the form with template data
                document.querySelector('[name="name"]').value = data.name + ' (Copy)';
                document.querySelector('[name="subject"]').value = data.subject;
                document.getElementById('html_body').value = data.html_body;
                document.querySelector('[name="text_body"]').value = data.text_body || '';
                document.querySelector('[name="placeholders"]').value = data.placeholders || '[]';
                
                // Open modal
                const modal = new bootstrap.Modal(document.getElementById('addModal'));
                modal.show();
                
                showToast('Template loaded for duplication. Modify and save.', 'info');
            } catch (error) {
                // Error already handled
            }
        }
    </script>
{% endblock %}
